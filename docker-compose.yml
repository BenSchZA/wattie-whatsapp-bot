version: '2'
services:
    wattie:
        build: .
        image: debian/latest:wattie
        environment:
           - FIREBASE_CERTIFICATE_LOCATION=/secrets/${FIREBASE_CERTIFICATE_NAME}
           - CELL_NUMBER='***REMOVED***'
           - MONITOR_FREQUENCY=30
           - TIMEOUT=30
        volumes:
            - pip_cache:/root/.cache/pip
            - ./downloads:/app/downloads
            - ./logs:/app/logs
            - ./data:/app/data
            - ${FIREBASE_CERTIFICATE_PATH}:/secrets
        ports:
            - 8001:8001
        depends_on:
            - mongodb
            - hub
            - selenium-firefox
        networks:
            - net
    mongodb:
        image: mongo:latest
        environment:
            - MONGO_DATA_DIR=/data/db
            - MONGO_LOG_DIR=/dev/null
        volumes:
            - mongodb:/data/db
        ports:
            - 27017:27017
        command: mongod --smallfiles --logpath=/dev/null
        networks:
            - net
    hub:
        image: selenium/hub:3.12.0-cobalt
        ports:
            - 4444:4444
        tty: true
        networks:
            - net
    selenium-firefox:
        image: selenium/node-firefox-debug:3.12.0-cobalt
        ports:
            - 5900:5900
        tty: true
        depends_on:
            - hub
        volumes:
            - /dev/shm:/dev/shm
        environment:
            - HUB_HOST=hub
            - HUB_PORT_4444_TCP_ADDR=hub
            - HUB_PORT_4444_TCP_PORT=4444
        networks:
            - net

volumes:
    mongodb:
    pip_cache:

networks:
    net:
      driver: bridge